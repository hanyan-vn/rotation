<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rotation</title>

    <link href="/css/common.css" rel="stylesheet">
    <link href="/css/wheel.css" rel="stylesheet">
</head>

<body>
<main class="main fortune">
    <div class="container fortune__body">

        <div id="wheel" class="fortune__wheel">
            <svg viewBox="0 0 800 800">
                <g class="chartholder" transform="translate(400,400)">
                    <g id="rotation">
                        <image xlink:href="/images/wheel.webp" width="800" height="800" x="-400" y="-400"></image>

                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(-78)translate(290)">NO LUCK ...<path fill-opacity="0.0" fill="#1f77b4" d="M1.8369701987210297e-14,-300A300,300 0 0,1 122.02099292274006,-274.06363729278024L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(-54)translate(290)">Discount 3%<path fill-opacity="0.0" fill="#aec7e8" d="M122.02099292274006,-274.06363729278024A300,300 0 0,1 222.94344764321826,-200.73918190765747L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(-30.000000000000007)translate(290)">Balance $50<path fill-opacity="0.0" fill="#ff7f0e" d="M222.94344764321826,-200.73918190765747A300,300 0 0,1 285.31695488854604,-92.70509831248422L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(-6.000000000000014)translate(290)">SORRY ...<path fill-opacity="0.0" fill="#ffbb78" d="M285.31695488854604,-92.70509831248422A300,300 0 0,1 298.356568610482,31.358538980296018L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(18)translate(290)">Balance $0.5<path fill-opacity="0.0" fill="#2ca02c" d="M298.356568610482,31.358538980296018A300,300 0 0,1 259.8076211353316,149.99999999999994L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(42)translate(290)">Balance $5<path fill-opacity="0.0" fill="#98df8a" d="M259.8076211353316,149.99999999999994A300,300 0 0,1 176.33557568774194,242.70509831248424L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(66)translate(290)">Balance $25<path fill-opacity="0.0" fill="#d62728" d="M176.33557568774194,242.70509831248424A300,300 0 0,1 62.37350724532777,293.4442802201417L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(90)translate(290)">Discount 15%<path fill-opacity="0.0" fill="#ff9896" d="M62.37350724532777,293.4442802201417A300,300 0 0,1 -62.37350724532787,293.44428022014165L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(114.00000000000003)translate(290)">Balance $10<path fill-opacity="0.0" fill="#9467bd" d="M-62.37350724532787,293.44428022014165A300,300 0 0,1 -176.335575687742,242.70509831248418L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(138.00000000000003)translate(290)">Discount 25%<path fill-opacity="0.0" fill="#c5b0d5" d="M-176.335575687742,242.70509831248418A300,300 0 0,1 -259.80762113533166,149.99999999999986L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(162)translate(290)">NO LUCK ...<path fill-opacity="0.0" fill="#8c564b" d="M-259.80762113533166,149.99999999999986A300,300 0 0,1 -298.35656861048204,31.358538980295986L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(186.00000000000006)translate(290)">Balance 100<path fill-opacity="0.0" fill="#c49c94" d="M-298.35656861048204,31.358538980295986A300,300 0 0,1 -285.3169548885461,-92.70509831248418L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(209.99999999999994)translate(290)">Discount 50%<path fill-opacity="0.0" fill="#e377c2" d="M-285.3169548885461,-92.70509831248418A300,300 0 0,1 -222.94344764321835,-200.73918190765738L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(234)translate(290)">Discount 7%<path fill-opacity="0.0" fill="#f7b6d2" d="M-222.94344764321835,-200.73918190765738A300,300 0 0,1 -122.02099292274028,-274.0636372927802L0,0Z"></path></text></g>
                        <g><text x="-110" y="5" class="wheelText" text-anchor="middle" text-rendering="optimizeLegibility" transform="rotate(257.9999999999999)translate(290)">Discount 5%<path fill-opacity="0.0" fill="#7f7f7f" d="M-122.02099292274028,-274.0636372927802A300,300 0 0,1 -3.2156263187166844e-13,-300L0,0Z"></path></text></g>

                    </g>
                </g>
                <image xlink:href="/images/outwheel.webp" width="800" height="800"></image>
            </svg>
        </div>

        <div class="fortune__form">
            <img class="fortune__form-logo" src="/images/accfarm_logo.svg">
            <div class="fortune__form-title text-center text-blue bold">SPIN THE WHEEL TO WIN!</div>
            <div class="fortune__form-subtitle text-center text-blue bold invisible"></div>
            <div class="fortune__form-text fortune__text invisible">
                <div class="fortune__text-item">
                    The administrator is already aware of your prize and will contact you shortly to let you know how to receive it.
                    Your details were successfully stored:
                </div>
                <div class="fortune__text-card">
                    <div class="fortune__text-row"><span class="wheel-title">prize:</span>&ensp;<span class="text-blue bold fortune__prize-name"></span></div>
                    <div class="fortune__prize-desc"></div>
                </div>
            </div>
            <button type="button" class="fortune__form-btn btn btn-green btn-large" id="rotation_btn">SPIN!</button>
            <p class="form-error"></p>
        </div>

    </div>
</main>

<script src="/js/jquery-3.6.0.min.js"></script>
<script>
    $("#rotation_btn").click(rotation());

    var rotationStatus = true;
    var rotationCount = $(".wheelText").length;
    var items = 360 / rotationCount;

    function rotation() {
        if (!rotationStatus) {
            return;
        }
        rotationStatus = false;

        $.ajax({
            url: "/ajax/rotation.php",
            method: "GET",
            data: {

            },
            success: function(response) {
                response = JSON.parse(response);
                var audio = new Audio('/audio/roulette.mp3');

                var location_item = response.location;
                var countLoop = 0;

                var r = 0;
                var loop = setInterval(() => {
                    audio.play();

                    document.getElementById("rotation").style.transform = "rotate(" + (360 - r) + "deg)";
                    if (r >= countLoop * location_item - countLoop / 2 && countLoop == 2) {
                        clearInterval(loop);
                        rotationStatus = true;
                        audio.pause();

                        alert(response.label);
                    } else {
                        if(x >= 360){
                            countLoop = countLoop + 1;
                            r = 0;
                        }
                    }
                    r = r + 1;
                }, 1);
            }
        });

    }
</script>
</body>

</html>
